<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Realtime sentiment</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      html {
        background-color: rgba(73, 88, 103, 1);
      }
    </style>
  </head>
  <body>
    <canvas id='chart'></canvas>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.34.0/smoothie.js"></script>
    <script>
        var dimension = [document.documentElement.clientWidth, document.documentElement.clientHeight];
        var c = document.getElementById("chart");
        c.width = dimension[0]-4;
        c.height = dimension[1]-4;

        var smoothie = new SmoothieChart({
          grid: {
            strokeStyle:'rgba(172, 179, 185, 0.1)',
            fillStyle:'rgba(73, 88, 103, 1)',
            lineWidth: 1,
            millisPerLine: 250,
            verticalSections: 12,
            borderVisible: false
          },
          labels: {
            disabled: true
          }
        });
        smoothie.streamTo(document.getElementById("chart"), 1000);

        var emotions = {
          anger: new TimeSeries(),
          disgust: new TimeSeries(),
          fear: new TimeSeries(),
          joy: new TimeSeries(),
          sadness: new TimeSeries()
        }

        // Add to SmoothieChart
        smoothie.addTimeSeries(
          emotions['anger'],
          {
            strokeStyle: 'rgba(240, 58, 71, 1)',
            fillStyle: 'rgba(240, 58, 71, 0.4)',
            lineWidth: 3
          }
        );
        smoothie.addTimeSeries(
          emotions['disgust'],
          {
            strokeStyle: 'rgba(216, 137, 47, 1)',
            fillStyle: 'rgba(216, 137, 47, 0.4)',
            lineWidth: 3
          }
        );
        smoothie.addTimeSeries(
          emotions['fear'],
          {
            strokeStyle: 'rgba(255, 246, 114, 1)',
            fillStyle: 'rgba(255, 246, 114, 0.4)',
            lineWidth: 3
          }
        );
        smoothie.addTimeSeries(
          emotions['joy'],
          {
            strokeStyle: 'rgba(181, 51, 191, 1)',
            fillStyle: 'rgba(181, 51, 191, 0.4)',
            lineWidth: 3
          }
        );
        smoothie.addTimeSeries(
          emotions['sadness'],
          {
            strokeStyle: 'rgba(22, 44, 81, 1)',
            fillStyle: 'rgba(22, 44, 81, 0.4)',
            lineWidth: 3
          }
        );

        var websocket = new WebSocket('{{ server_url }}/dashboard-socket');
        websocket.onmessage = function(evt) {
          JSON.parse(evt.data).map(function(emotion){
            emotions[emotion.tone_id].append(new Date().getTime(), emotion.score)
          });
        }
    </script>
  </body>
</html>